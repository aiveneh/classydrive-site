{"ast":null,"code":"import { handleActions } from 'redux-actions';\nimport { createSelector } from 'reselect';\nimport { produce } from 'immer';\nimport { combineEpics } from 'redux-observable';\nimport { ofType, catchError, switchMap, of } from 'storejars-react-toolkit/dist/operators';\nimport { Actions, entitiesMeta, entities, responder, metas } from 'storejars-react-toolkit';\nimport { api, tokenStorage } from '../helpers';\nimport namespaces from '../namespaces';\nexport const action = new Actions(namespaces.USERS);\nexport const selector = createSelector(entities, state => state.users);\nexport const metaSelector = createSelector(entitiesMeta, state => state.users);\nexport const reducer = handleActions({\n  [action.read.success]: (state, action$) => produce(state, draft => {\n    draft.data = action$.payload;\n    return draft;\n  })\n}, {\n  data: []\n});\nexport const metaReducer = metas(action);\n\nfunction createEpic(action$, store$) {\n  return action$.pipe(ofType(action.create.loading), switchMap(({\n    payload\n  }) => {\n    return api.post$('/users', payload).pipe(switchMap(({\n      response\n    }) => {\n      tokenStorage.set(response.data);\n      return of(action.createAction(response.data).success);\n    }), catchError(({\n      response\n    }) => of(action.createAction(responder(response)).error)));\n  }));\n}\n\nfunction readEpic(action$) {\n  return action$.pipe(ofType(action.read.loading), switchMap(({\n    payload\n  }) => {\n    return api.get$('/users').pipe(switchMap(({\n      response\n    }) => {\n      return of(action.readAction(response.data).success);\n    }), catchError(({\n      response\n    }) => of(action.readAction(responder(response)).error)));\n  }));\n}\n\nfunction deleteEpic(action$) {\n  return action$.pipe(ofType(action.read.loading), switchMap(({\n    payload\n  }) => {\n    return api.post$('/users', payload).pipe(switchMap(({\n      response\n    }) => {\n      return of(action.readAction(response.data).success);\n    }), catchError(({\n      response\n    }) => of(action.readAction(responder(response)).error)));\n  }));\n}\n\nexport const epic = combineEpics(readEpic, createEpic, deleteEpic);","map":null,"metadata":{},"sourceType":"module"}